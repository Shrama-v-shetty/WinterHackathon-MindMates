<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CampusCare Dashboard</title>
  <link rel="stylesheet" href="dashboard.css">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>

<body>

<!-- Navbar -->
<header class="navbar">
  <div class="logo">
    <img src="img3.png" class="brand-icon">
    <span class="brand-name">MindMates</span>
  </div>
</header>

<!-- Welcome -->
<section class="welcome">
  <h2>Welcome back!</h2>
  <p>How can we support you today?</p>
</section>

<!-- Quick Actions -->
<section class="actions">
  <div class="action-card blue" onclick="openModal()">ðŸ“…
    <h4>Book Appointment</h4>
    <p>Schedule a session</p>
  </div>

  <div class="action-card green" onclick="openChat()">ðŸ’¬
    <h4>Chat Now</h4>
    <p>Message a counselor</p>
  </div>

  <div class="action-card purple" onclick="openVideo()">ðŸŽ¥
    <h4>Video Call</h4>
    <p>Face-to-face session</p>
  </div>

  <div class="action-card violet" onclick="openChatbot()">ðŸ§ 
    <h4>AI Counselor</h4>
    <p>24/7 AI assistance</p>
  </div>
</section>

<!-- Upcoming Appointments -->
<section class="card">
  <h3>Upcoming Appointments</h3>
  <div id="studentAppointments"></div>
</section>

<!-- Emergency -->
<section class="emergency">
  <h3>ðŸš¨ Emergency Help</h3>
  <p>If you're in crisis, we're here 24/7</p>
  <button class="btn dark" onclick="openHospital()">Nearby Hospitals</button>
</section>

<!-- Appointment Modal -->
<div id="appointmentModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Book Appointment</h3>
      <span class="close" onclick="closeModal()">Ã—</span>
    </div>

    <div class="modal-body">
      <label>Select Date</label>
      <input type="date" id="apptDate">

      <label>Select Time</label>
      <select id="apptTime">
        <option value="">Select Time</option>
        <option>9:00 AM</option>
        <option>10:00 AM</option>
        <option>11:00 AM</option>
      </select>

      <label>Session Type</label>
      <div class="session-type">
        <button class="session active">Video Call</button>
        <button class="session">Chat</button>
      </div>

      <button class="confirm-btn" onclick="AlertConfirm()">Confirm Booking</button>
    </div>
  </div>
</div>

<!-- =================== SCRIPT =================== -->
<script>
/* ðŸ”¥ Firebase Config */
const firebaseConfig = {
   apiKey: "AIzaSyC8C6ncKCm4cH0yhMZaPHzzS5GfbDZvp84",
  authDomain: "mindmates-286b9.firebaseapp.com",
  projectId: "mindmates-286b9",
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

/* Modal */
function openModal() {
  document.getElementById("appointmentModal").style.display = "flex";
}
function closeModal() {
  document.getElementById("appointmentModal").style.display = "none";
}

/* Session toggle */
document.addEventListener("click", e => {
  if (e.target.classList.contains("session")) {
    document.querySelectorAll(".session").forEach(b => b.classList.remove("active"));
    e.target.classList.add("active");
  }
});

/* Navigation */
function openChat(){ window.location.href="chat.html"; }
function openVideo(){ window.location.href="video.html"; }
function openChatbot(){ window.location.href="chatbot.html"; }
function openHospital(){
  window.open("https://www.google.com/maps/search/hospitals+near+me/", "_blank");
}

/* ðŸ”¥ Confirm Booking */
function AlertConfirm() {
  const user = auth.currentUser;
  if (!user) return alert("Please login again");

  const date = document.getElementById("apptDate").value;
  const time = document.getElementById("apptTime").value;
  const mode = document.querySelector(".session.active").textContent;

  if (!date || !time) return alert("Select date & time");

  db.collection("appointments").add({
    studentId: user.uid,
    studentName: user.isAnonymous ? "Anonymous" : user.email,
    counsellorId: "COUNSELLOR_001",
    counsellorName: "Dr. Sarah Johnson",
    date: firebase.firestore.Timestamp.fromDate(new Date(date)),
    time: time,
    mode: mode,
    status: "upcoming",
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  })
  .then(() => {
    alert("âœ… Appointment Booked!");
    closeModal();
  })
  .catch(err => alert(err.message));
}

/* ðŸ”¥ Load Upcoming Appointments */
auth.onAuthStateChanged(user => {
  if (!user) return;

  const container = document.getElementById("studentAppointments");

  db.collection("appointments")
    .where("studentId", "==", user.uid)
    .where("status", "==", "upcoming")
    .orderBy("date")
    .onSnapshot(snapshot => {
      container.innerHTML = "";

      if (snapshot.empty) {
        container.innerHTML = "<p>No upcoming appointments</p>";
        return;
      }

      snapshot.forEach(doc => {
        const a = doc.data();
        container.innerHTML += `
          <div class="appointment">
            <strong>${a.counsellorName}</strong>
            <p>ðŸ“… ${a.date.toDate().toDateString()} | ${a.time}</p>
            <span>${a.mode}</span>
          </div>
        `;
      });
    });
});
</script>

</body>
</html>

